<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Test SonuÃ§ Ã–zeti</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #818cf8;
      --bg-main: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #1e293b;
      --text: #f1f5f9;
      --text-muted: #94a3b8;
      --border: #334155;
      --success: #22c55e;
      --warning: #f59e0b;
      --error: #ef4444;
      --cyan: #06b6d4;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(99, 102, 241, 0.25), transparent);
      border-radius: 50%;
      top: -250px;
      right: -250px;
      animation: pulse 8s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    body::after {
      content: '';
      position: fixed;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(6, 182, 212, 0.2), transparent);
      border-radius: 50%;
      bottom: -200px;
      left: -200px;
      animation: pulse 10s ease-in-out infinite reverse;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.15); opacity: 0.8; }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .app {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header */
    .header {
      background: rgba(30, 41, 59, 0.95);
      backdrop-filter: blur(20px);
      padding: 28px 36px;
      border-radius: 20px;
      margin-bottom: 24px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      animation: slideUp 0.6s ease-out;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      width: 56px;
      height: 56px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
    }

    .header-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    h1 {
      font-size: 26px;
      font-weight: 700;
      color: var(--text);
      margin: 0;
      letter-spacing: -0.02em;
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-muted);
    }

    .btn {
      border: none;
      border-radius: 12px;
      padding: 12px 24px;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      color: white;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
    }

    .btn-primary:hover {
      box-shadow: 0 12px 28px rgba(99, 102, 241, 0.4);
      transform: translateY(-2px);
    }

    /* Summary Box */
    .summary-box {
      background: rgba(30, 41, 59, 0.95);
      backdrop-filter: blur(20px);
      padding: 36px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: grid;
      gap: 24px;
      animation: slideUp 0.7s ease-out;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 20px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid rgba(99, 102, 241, 0.2);
    }

    /* Test Cards */
    .test-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 8px;
    }

    .result-card {
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.3s ease;
      animation: fadeIn 0.8s ease;
    }

    .result-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.3);
    }

    .result-card h3 {
      font-size: 18px;
      font-weight: 700;
      color: var(--text);
      margin: 0 0 16px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .test-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }

    .result-content {
      display: grid;
      gap: 12px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      background: rgba(99, 102, 241, 0.05);
      border-radius: 10px;
      border: 1px solid rgba(99, 102, 241, 0.1);
    }

    .stat-label {
      color: var(--text-muted);
      font-size: 14px;
      font-weight: 500;
    }

    .stat-value {
      color: var(--primary-light);
      font-size: 16px;
      font-weight: 700;
    }

    .stat-value.success {
      color: var(--success);
    }

    .stat-value.error {
      color: var(--error);
    }

    .no-result {
      color: var(--text-muted);
      font-style: italic;
      text-align: center;
      padding: 20px;
    }

    /* Table */
    .table-wrapper {
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 24px;
      overflow-x: auto;
      animation: fadeIn 0.9s ease;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    table thead {
      background: rgba(99, 102, 241, 0.1);
    }

    table th {
      padding: 14px 16px;
      text-align: left;
      font-weight: 700;
      color: var(--primary-light);
      border-bottom: 2px solid rgba(99, 102, 241, 0.2);
      white-space: nowrap;
    }

    table td {
      padding: 14px 16px;
      color: var(--text);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    table tbody tr {
      transition: background 0.2s ease;
    }

    table tbody tr:hover {
      background: rgba(99, 102, 241, 0.05);
    }

    table tbody tr:last-child td {
      border-bottom: none;
    }

    .loading {
      text-align: center;
      color: var(--text-muted);
      padding: 20px;
    }

    /* Footer */
    footer {
      margin-top: 24px;
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      font-size: 13px;
      font-weight: 500;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        padding: 20px;
        flex-direction: column;
        align-items: flex-start;
      }

      .summary-box {
        padding: 20px;
      }

      .test-cards {
        grid-template-columns: 1fr;
      }

      h1 {
        font-size: 22px;
      }

      .table-wrapper {
        padding: 16px;
      }

      table {
        font-size: 12px;
      }

      table th,
      table td {
        padding: 10px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <div class="logo">ğŸ“Š</div>
        <div class="header-title">
          <h1>Test SonuÃ§ Ã–zeti</h1>
          <div class="subtitle">TÃ¼m test sonuÃ§larÄ±nÄ±zÄ± burada gÃ¶rÃ¼ntÃ¼leyebilirsiniz</div>
        </div>
      </div>
      <a href="../index.html" class="btn btn-primary">ğŸ  Ana Sayfaya DÃ¶n</a>
    </div>

    <!-- Summary Box -->
    <div class="summary-box">
      <div class="section-title">
        <span>ğŸ¯</span>
        <span>Son Test SonuÃ§larÄ±</span>
      </div>

      <div class="test-cards">
        <!-- Test 1 -->
        <div class="result-card">
          <h3>
            <div class="test-icon">âš¡</div>
            Harf/SayÄ± Tepki Testi
          </h3>
          <div id="test1" class="result-content">
            <div class="loading">YÃ¼kleniyor...</div>
          </div>
        </div>

        <!-- Test 2 -->
        <div class="result-card">
          <h3>
            <div class="test-icon">ğŸ¯</div>
            Ã‡ift GÃ¶rev Tepki Testi
          </h3>
          <div id="test2" class="result-content">
            <div class="loading">YÃ¼kleniyor...</div>
          </div>
        </div>

        <!-- Test 3 -->
        <div class="result-card">
          <h3>
            <div class="test-icon">ğŸ”·</div>
            Åekiller SÄ±ralama Testi
          </h3>
          <div id="test3" class="result-content">
            <div class="loading">YÃ¼kleniyor...</div>
          </div>
        </div>
      </div>

      <div class="section-title" style="margin-top: 16px;">
        <span>ğŸ“ˆ</span>
        <span>GeÃ§miÅŸ Test KayÄ±tlarÄ±</span>
      </div>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>ğŸ“Œ ID</th>
              <th>ğŸ“ Test AdÄ±</th>
              <th>ğŸ¯ Puan</th>
              <th>ğŸ“… Tarih</th>
              <th>ğŸ“Š Detaylar</th>
            </tr>
          </thead>
          <tbody id="results-body">
            <tr>
              <td colspan="5" class="loading">YÃ¼kleniyor...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <footer>
      Â© <span id="year"></span> Psikolojik Test Sistemi
    </footer>
  </div>

  <script src="../api.js"></script>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    function formatTestName(raw) {
      switch (raw) {
        case 'test1':
          return 'âš¡ Harf/SayÄ± Tepki Testi';
        case 'test2':
          return 'ğŸ¯ Ã‡ift GÃ¶rev Tepki Testi';
        case 'test3':
          return 'ğŸ”· Åekiller SÄ±ralama Testi';
        default:
          return raw || '-';
      }
    }

    function showResult(key, targetId) {
      const data = JSON.parse(localStorage.getItem(key));
      const target = document.getElementById(targetId);

      if (data) {
        let html = '<div class="result-content">';
        
        // Puan
        html += `<div class="stat-item">
          <span class="stat-label">ğŸ¯ Puan</span>
          <span class="stat-value">${data.score}</span>
        </div>`;

        // Test 1 & 2 stats
        if (data.hits !== undefined) {
          html += `<div class="stat-item">
            <span class="stat-label">âœ… DoÄŸru</span>
            <span class="stat-value success">${data.hits}</span>
          </div>`;
        }
        
        if (data.misses !== undefined) {
          html += `<div class="stat-item">
            <span class="stat-label">â­• KaÃ§Ä±rma</span>
            <span class="stat-value">${data.misses}</span>
          </div>`;
        }
        
        if (data.falseAlarms !== undefined) {
          html += `<div class="stat-item">
            <span class="stat-label">âŒ HatalÄ± TÄ±klama</span>
            <span class="stat-value error">${data.falseAlarms}</span>
          </div>`;
        }

        // Test 2 circle stats
        if (data.circleHits !== undefined) {
          html += `<div class="stat-item">
            <span class="stat-label">ğŸ”µ Daire TÄ±klama</span>
            <span class="stat-value success">${data.circleHits}</span>
          </div>`;
        }
        
        if (data.circleMisses !== undefined) {
          html += `<div class="stat-item">
            <span class="stat-label">âšª Daire KaÃ§Ä±rma</span>
            <span class="stat-value">${data.circleMisses}</span>
          </div>`;
        }

        // Test 3 stats
        if (data.correct !== undefined) {
          html += `<div class="stat-item">
            <span class="stat-label">âœ… DoÄŸru TÄ±klama</span>
            <span class="stat-value success">${data.correct}</span>
          </div>`;
        }
        
        if (data.wrong !== undefined) {
          html += `<div class="stat-item">
            <span class="stat-label">âŒ YanlÄ±ÅŸ TÄ±klama</span>
            <span class="stat-value error">${data.wrong}</span>
          </div>`;
        }

        if (data.durationSec !== undefined) {
          html += `<div class="stat-item">
            <span class="stat-label">â±ï¸ SÃ¼re</span>
            <span class="stat-value">${data.durationSec} sn</span>
          </div>`;
        }

        // Total stimuli
        if (data.totalStim !== undefined) {
          html += `<div class="stat-item">
            <span class="stat-label">ğŸ“ Toplam UyarÄ±cÄ±</span>
            <span class="stat-value">${data.totalStim}</span>
          </div>`;
        }

        // Timestamp
        html += `<div class="stat-item">
          <span class="stat-label">ğŸ“… Tarih</span>
          <span class="stat-value" style="font-size: 13px;">${new Date(data.timestamp).toLocaleString('tr-TR')}</span>
        </div>`;

        html += '</div>';
        target.innerHTML = html;
      } else {
        target.innerHTML = '<div class="no-result">HenÃ¼z sonuÃ§ yok.</div>';
      }
    }

    async function loadResults() {
      const tbody = document.getElementById('results-body');

      try {
        const results = await TestApi.getMyResults();

        if (!results || !results.length) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color: var(--text-muted); padding: 24px;">KayÄ±tlÄ± test sonucu bulunamadÄ±.</td></tr>';
          return;
        }

        tbody.innerHTML = '';
        for (const r of results) {
          const tr = document.createElement('tr');
          
          const detailParts = [];
          if (r.hits !== null && r.hits !== undefined) detailParts.push(`âœ… ${r.hits}`);
          if (r.misses !== null && r.misses !== undefined) detailParts.push(`â­• ${r.misses}`);
          if (r.false_alarms !== null && r.false_alarms !== undefined) detailParts.push(`âŒ ${r.false_alarms}`);
          
          const detailStr = detailParts.length > 0 ? detailParts.join(' â€¢ ') : '-';
          
          tr.innerHTML = `
            <td style="font-weight: 600; color: var(--primary-light);">#${r.id}</td>
            <td>${formatTestName(r.test_name)}</td>
            <td style="font-weight: 700; color: var(--primary-light);">${r.score}</td>
            <td style="font-size: 13px;">${new Date(r.created_at).toLocaleString('tr-TR')}</td>
            <td style="font-size: 13px;">${detailStr}</td>
          `;
          tbody.appendChild(tr);
        }
      } catch (err) {
        console.error('SonuÃ§lar yÃ¼klenirken hata:', err);
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; color: var(--error); padding: 24px;">âŒ SonuÃ§lar yÃ¼klenirken hata oluÅŸtu.</td></tr>';
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      showResult('test1Result', 'test1');
      showResult('test2Result', 'test2');
      showResult('test3Result', 'test3');
      loadResults();
    });
  </script>
</body>
</html>